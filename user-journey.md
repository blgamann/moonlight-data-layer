# 사용자 여정 (User Journey)

이 문서는 Moonlight 데이터 레이어에서 지원하는 주요 사용자 여정을 설명합니다. 각 여정은 사용자가 시스템과 상호작용하는 방식과 그 과정에서 발생하는 데이터 흐름을 보여줍니다.

## 1. 사용자 계정 관리 여정

### 1.1 신규 사용자 등록
1. 사용자가 이메일, 비밀번호, 이름(선택), 자기소개(선택), 프로필 이미지(선택)를 입력하여 계정 생성 요청
2. 시스템이 이메일 중복 확인 후 비밀번호를 해시 처리하여 저장
3. 사용자 정보가 `User` 테이블에 저장됨
4. 사용자에게 성공적인 등록 확인 메시지 전송

### 1.2 로그인
1. 사용자가 이메일과 비밀번호를 입력하여 로그인 요청
2. 시스템이 이메일로 사용자 검색 후 비밀번호 해시 검증
3. 인증 성공 시 사용자 세션 생성 및 마지막 로그인 시간 업데이트
4. 사용자에게 인증 토큰 제공

### 1.3 프로필 관리
1. 사용자가 자신의 프로필 정보 조회
2. 사용자가 이름, 자기소개, 프로필 이미지 등 개인 정보 수정
3. 변경된 정보가 `User` 테이블에 업데이트됨
4. 사용자에게 성공적인 업데이트 확인 메시지 전송

### 1.4 계정 삭제
1. 사용자가 계정 삭제 요청
2. 시스템이 사용자 인증 확인
3. 사용자 관련 모든 데이터(서재, 답변, 관심 표현 등) 삭제
4. `User` 테이블에서 사용자 정보 삭제
5. 사용자에게 성공적인 계정 삭제 확인 메시지 전송

## 2. 도서 검색 및 서재 관리 여정

### 2.1 도서 검색
1. 사용자가 키워드를 입력하여 도서 검색
2. 시스템이 외부 API(`https://book-server-roan.vercel.app/books/{keyword}`)에 검색 요청
3. 외부 API가 검색 결과(제목, 저자, 출판사, ISBN 등) 반환
4. 시스템이 검색 결과를 사용자에게 표시

### 2.2 서재에 도서 추가
1. 사용자가 검색 결과에서 도서를 선택하여 서재에 추가 요청
2. 시스템이 해당 도서가 `Book` 테이블에 있는지 확인
3. 없을 경우, 외부 API에서 받은 도서 정보를 `Book` 테이블에 저장
4. 사용자와 도서를 연결하는 정보를 `BookshelfEntry` 테이블에 저장
5. 사용자에게 성공적인 서재 추가 확인 메시지 전송

### 2.3 서재에서 도서 제거
1. 사용자가 자신의 서재에서 도서 제거 요청
2. 시스템이 `BookshelfEntry` 테이블에서 해당 사용자와 도서의 연결 정보 삭제
3. 사용자에게 성공적인 서재 제거 확인 메시지 전송

## 3. 질문 및 답변 여정

### 3.1 도서에 대한 답변 작성 (최초)
1. 사용자가 특정 도서에 대한 답변 작성 시도
2. 시스템이 해당 도서가 `Book` 테이블에 있는지 확인
   - 없을 경우, 외부 API에서 도서 정보를 가져와 `Book` 테이블에 저장
3. 시스템이 해당 도서에 대한 시스템 질문이 `Question` 테이블에 있는지 확인
   - 없을 경우, 표준 질문(예: "[도서 제목]을 읽고 느낀 점을 공유해주세요.")을 `Question` 테이블에 저장
4. 사용자가 작성한 답변을 `Answer` 테이블에 저장
5. 사용자에게 성공적인 답변 작성 확인 메시지 전송

### 3.2 답변 조회 및 관리
1. 사용자가 특정 도서의 질문에 대한 답변들 조회
2. 시스템이 `Answer` 테이블에서 해당 질문에 대한 모든 답변 검색
3. 사용자가 자신의 답변 수정 또는 삭제 요청
4. 시스템이 `Answer` 테이블에서 해당 답변 업데이트 또는 삭제
5. 사용자에게 성공적인 답변 수정/삭제 확인 메시지 전송

## 4. 사용자 간 상호작용 여정

### 4.1 프로필 관심 표현
1. 사용자 A가 사용자 B의 프로필에 관심 표현
2. 시스템이 `ProfileInterest` 테이블에 관심 표현 정보 저장
3. 사용자 B가 이미 사용자 A에게 관심을 표현했는지 확인
   - 상호 관심일 경우, 양측에 `MUTUAL_PROFILE_INTEREST` 타입의 알림 생성
4. 사용자 A에게 성공적인 관심 표현 확인 메시지 전송

### 4.2 답변 관심 표현
1. 사용자 A가 사용자 B의 답변에 관심 표현
2. 시스템이 `AnswerInterest` 테이블에 관심 표현 정보 저장
3. 사용자 A에게 성공적인 관심 표현 확인 메시지 전송

### 4.3 소울링크 요청
1. 상호 관심 상태인 사용자 A가 사용자 B에게 소울링크 요청
2. 시스템이 `SoullinkRequest` 테이블에 요청 정보 저장
3. 사용자 B가 이미 사용자 A에게 소울링크를 요청했는지 확인
   - 양방향 요청일 경우, `Soulmate` 테이블에 소울메이트 관계 저장 및 양측에 `SOULMATE_FORMED` 타입의 알림 생성
4. 사용자 A에게 성공적인 소울링크 요청 확인 메시지 전송

### 4.4 소울메이트 관계 관리
1. 사용자가 자신의 소울메이트 목록 조회
2. 시스템이 `Soulmate` 테이블에서 해당 사용자의 소울메이트 관계 검색
3. 사용자가 특정 소울메이트와의 관계 해제 요청
4. 시스템이 `Soulmate` 테이블에서 해당 관계 삭제
5. 사용자에게 성공적인 관계 해제 확인 메시지 전송

## 5. 알림 여정

### 5.1 알림 수신
1. 시스템이 특정 이벤트(상호 관심, 소울메이트 형성 등)에 따라 알림 생성
2. 알림 정보가 `Notification` 테이블에 저장됨
3. 사용자가 알림 목록 조회
4. 시스템이 `Notification` 테이블에서 해당 사용자의 알림 검색

### 5.2 알림 관리
1. 사용자가 알림 확인
2. 시스템이 `Notification` 테이블에서 해당 알림의 `isRead` 필드를 true로 업데이트
3. 사용자가 알림 선택하여 관련 정보(프로필, 소울메이트 등)로 이동
4. 시스템이 선택된 알림과 관련된 정보 제공

## 6. 통합 여정 예시: 독서 기반 소울메이트 형성

### 6.1 처음부터 끝까지의 여정
1. 사용자 A가 회원가입 및 로그인
2. 사용자 A가 도서 검색 후 서재에 추가
3. 사용자 A가 도서에 대한 답변 작성
4. 사용자 B가 회원가입 및 로그인
5. 사용자 B가 같은 도서에 대한 답변 작성
6. 사용자 B가 사용자 A의 답변에 관심 표현
7. 사용자 A가 사용자 B의 프로필에 관심 표현
8. 사용자 B가 사용자 A의 프로필에 관심 표현
   - 상호 관심 상태가 되어 양측에 `MUTUAL_PROFILE_INTEREST` 알림 생성
9. 사용자 A가 사용자 B에게 소울링크 요청
10. 사용자 B가 사용자 A에게 소울링크 요청
    - 소울메이트 관계가 형성되어 양측에 `SOULMATE_FORMED` 알림 생성
11. 사용자 A와 B가 소울메이트로서 서로의 독서 활동 공유

이 여정들은 Moonlight 데이터 레이어의 핵심 기능을 보여주며, 각 단계에서 데이터가 어떻게 생성되고 관리되는지 설명합니다. 테스트 코드는 이러한 여정이 정상적으로 작동하는지 검증합니다.
